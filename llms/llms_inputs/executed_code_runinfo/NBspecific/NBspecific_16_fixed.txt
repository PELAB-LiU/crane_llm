# Executed Cells:
## Cell 1:

import os
import math
import random
import warnings

import matplotlib.pyplot as plt
import seaborn as sns

import tensorflow as tf

import numpy as np
import pandas as pd

## Cell 2:

HEIGHT = 224
WIDTH = 224
CHANNELS = 3

INPUT_SHAPE = (HEIGHT, WIDTH, CHANNELS)
LEARNING_RATE = 0.00001

EPOCHS = 3
BATCH_SIZE = 32

DROPOUT = 0.5

## Cell 3:


base_skin_dir = os.path.join('data_small', 'skin-cancer-mnist-ham10000')
skin_df = pd.read_csv(os.path.join(base_skin_dir, 'HAM10000_metadata.csv'))

from glob import glob
imageid_path_dict = {os.path.splitext(os.path.basename(x))[0]: x
                     for x in glob(os.path.join(base_skin_dir, '*', '*.jpg'))}

lesion_type_dict = {
    'nv': 'Melanocytic nevi',
    'mel': 'Melanoma',
    'bkl': 'Benign keratosis-like lesions ',
    'bcc': 'Basal cell carcinoma',
    'akiec': 'Actinic keratoses',
    'vasc': 'Vascular lesions',
    'df': 'Dermatofibroma'
}
skin_df['path'] = skin_df['image_id'].map(imageid_path_dict.get)
skin_df['cell_type'] = skin_df['dx'].map(lesion_type_dict.get)
skin_df['cell_type_idx'] = pd.Categorical(skin_df['cell_type']).codes

skin_df['age'].fillna((skin_df['age'].mean()), inplace=True)
skin_df.head()

# Current relevent runtime information:
{'__method__skin_df_head': {'type': "<class 'method'>"},
 'skin_df': {'execution_cell_source': {'cellno': 2, 'lineno': 3},
             'has_nan': True,
             'per_column': {'age': {'num_unique': 19,
                                    'type': 'continuous',
                                    'value_range': (0.0, 85.0)},
                            'cell_type': {'example_values': ['Benign '
                                                             'keratosis-lik...',
                                                             'Melanocytic nevi',
                                                             'Dermatofibroma',
                                                             'Melanoma',
                                                             'Vascular '
                                                             'lesions'],
                                          'num_unique': 7,
                                          'type': 'categorical'},
                            'cell_type_idx': {'num_unique': 7,
                                              'type': 'categorical_numeric',
                                              'value_range': (0, 6)},
                            'dx': {'example_values': ['bkl',
                                                      'nv',
                                                      'df',
                                                      'mel',
                                                      'vasc'],
                                   'num_unique': 7,
                                   'type': 'categorical'},
                            'dx_type': {'num_unique': 4,
                                        'type': 'categorical',
                                        'unique_values': ['histo',
                                                          'consensus',
                                                          'confocal',
                                                          'follow_up']},
                            'image_id': {'example_values': ['ISIC_0027419',
                                                            'ISIC_0025030',
                                                            'ISIC_0026769',
                                                            'ISIC_0025661',
                                                            'ISIC_0031633'],
                                         'num_unique': 10015,
                                         'type': 'categorical'},
                            'lesion_id': {'example_values': ['HAM_0000118',
                                                             'HAM_0002730',
                                                             'HAM_0001466',
                                                             'HAM_0002761',
                                                             'HAM_0005132'],
                                          'num_unique': 7470,
                                          'type': 'categorical'},
                            'localization': {'example_values': ['scalp',
                                                                'ear',
                                                                'face',
                                                                'back',
                                                                'trunk'],
                                             'num_unique': 15,
                                             'type': 'categorical'},
                            'path': {'example_values': ['data_small/skin-canc...',
                                                        'data_small/skin-canc...',
                                                        'data_small/skin-canc...',
                                                        'data_small/skin-canc...',
                                                        'data_small/skin-canc...'],
                                     'num_unique': 48,
                                     'type': 'categorical'},
                            'sex': {'num_unique': 3,
                                    'type': 'categorical',
                                    'unique_values': ['male',
                                                      'female',
                                                      'unknown']}},
             'shape': (10015, 10),
             'type': 'pandas.core.frame.DataFrame'}}
# Target Cell:

skin_df.head()